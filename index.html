<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Matrix Exam – แถวคี่ vs แถวคู่</title>
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#f9fafb; --card:#ffffff; --muted:#6b7280; --text:#111827;
      --accent:#007aff; --good:#34c759; --bad:#ff3b30; --warn:#ff9500; --border:#d1d5db;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    h1{margin:0 0 10px;font-size:26px}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:none;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn-ghost{background:#f3f4f6;border:1px solid var(--border);color:#111827}
    .btn-primary{background:var(--accent);color:#fff;font-weight:600}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* top bar */
    .topbar{display:flex;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap}
    .top-left{display:flex;align-items:center;gap:12px}
    .top-center{flex:1 1 auto;text-align:center}
    .credit{font-size:12px;color:var(--muted);line-height:1.2}
    .top-right{display:flex;align-items:center;gap:8px}
    .time{font-variant-numeric:tabular-nums;font-weight:700}
    .time.warn{color:var(--warn)}
    .time.dead{color:var(--bad)}
    .full{flex-basis:100%}
    .grid-nav{display:grid;grid-template-columns:repeat(10,1fr);gap:8px}
    .qbtn{padding:8px 0;border-radius:10px;border:1px solid var(--border);background:#f3f4f6;color:#6b7280}
    .qbtn.current{outline:2px solid var(--accent);background:#dbeafe;color:#007aff}

    .split{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:14px}
    .split::before{content:"";position:absolute;top:0;bottom:0;left:50%;width:2px;background:var(--border);transform:translateX(-1px);pointer-events:none}
    .panel{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
    .panel h3{margin:0 0 10px}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .mwrap{display:inline-block;border:1px solid var(--border);border-radius:10px;padding:10px;background:#f9fafb}
    table.matrix{border-collapse:collapse}
    table.matrix td{border:1px solid #cbd5e1;padding:6px 10px;text-align:center;min-width:32px}
    .mx{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .solutions{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .ans-card{border:1px solid var(--border);border-radius:12px;padding:12px;background:#f9fafb;margin-bottom:10px}

    /* Sticky header (answer page) */
    .sticky-head{position:sticky;top:0;z-index:20;background:var(--card);
      margin:-16px -16px 12px -16px;padding:12px 16px 10px;border-bottom:1px solid var(--border);box-shadow:0 2px 6px rgba(0,0,0,.04)}
    .sticky-head h1{margin:0 0 6px;text-align:center}
    .sticky-head p{margin:0;text-align:center}

    @media (max-width: 900px){
      .split{grid-template-columns:1fr}
      .split::before{display:none}
      .solutions{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="wrap">
  <!-- TOP -->
  <div id="topbar" class="topbar card">
    <div class="top-left">
      <span class="pill"><strong>เวลาที่เหลือ:</strong> <span id="timeLeft" class="time">30:00</span></span>
      <button id="add5" class="btn btn-ghost">ต่อเวลาพิเศษ +5 นาที</button>
    </div>
    <div class="top-center">
      <div class="credit">
        จัดทำและพัฒนาโดย คุณครูปฏิญญา มุ่งหมาย กลุ่มสาระการเรียนรู้คณิตศาสตร์ โรงเรียนขอนแก่นวิทยายน
      </div>
    </div>
    <div class="top-right">
      <button id="prevBtn" class="btn btn-ghost">◀ ก่อนหน้า</button>
      <button id="nextBtn" class="btn btn-ghost">ถัดไป ▶</button>
      <button id="showAns" class="btn btn-primary">เฉลย</button>
    </div>
    <div class="full">
      <div id="navGrid" class="grid-nav" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- QUESTIONS -->
  <section id="qView" class="card">
    <h1 style="text-align:center">Matrix Exam – แถวคี่ vs แถวคู่</h1>
    <p style="text-align:center" class="muted">ฝั่งซ้าย: <b>แถวคี่ (1,3,5)</b> | ฝั่งขวา: <b>แถวคู่ (2,4,6)</b></p>

    <div class="split">
      <div class="panel">
        <h3>แถวคี่ (1,3,5)</h3>
        <div id="leftProblem"></div>
      </div>
      <div class="panel">
        <h3>แถวคู่ (2,4,6)</h3>
        <div id="rightProblem"></div>
      </div>
    </div>
  </section>

  <!-- ANSWERS -->
  <section id="aView" class="card" style="display:none">
    <div class="sticky-head">
      <h1>เฉลย – คำถามเต็ม + คำตอบ</h1>
      <p class="muted">ฝั่งซ้าย: <b>แถวคี่ (1,3,5)</b> | ฝั่งขวา: <b>แถวคู่ (2,4,6)</b></p>
    </div>
    <div class="solutions">
      <div>
        <h3>แถวคี่ (1,3,5)</h3>
        <div id="leftSolutions"></div>
      </div>
      <div>
        <h3>แถวคู่ (2,4,6)</h3>
        <div id="rightSolutions"></div>
      </div>
    </div>
    <div style="margin-top:14px">
      <button id="backBtn" class="btn btn-ghost">กลับไปโจทย์</button>
    </div>
  </section>
</div>

<script>
/* ------------ helpers ------------ */
const rint = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
const deepCopy = (o)=> JSON.parse(JSON.stringify(o));
function makeMatrix(r,c,pick=()=>rint(-5,5)){const m=[];for(let i=0;i<r;i++){const row=[];for(let j=0;j<c;j++)row.push(pick());m.push(row)}return m}
function add(A,B){const r=A.length,c=A[0].length,M=makeMatrix(r,c,()=>0);for(let i=0;i<r;i++)for(let j=0;j<c;j++)M[i][j]=A[i][j]+B[i][j];return M}
function sub(A,B){const r=A.length,c=A[0].length,M=makeMatrix(r,c,()=>0);for(let i=0;i<r;i++)for(let j=0;j<c;j++)M[i][j]=A[i][j]-B[i][j];return M}
function scalar(A,k){const r=A.length,c=A[0].length,M=makeMatrix(r,c,()=>0);for(let i=0;i<r;i++)for(let j=0;j<c;j++)M[i][j]=A[i][j]*k;return M}
function transpose(A){const r=A.length,c=A[0].length,M=makeMatrix(c,r,()=>0);for(let i=0;i<r;i++)for(let j=0;j<c;j++)M[j][i]=A[i][j];return M}
function mul2x2(A,B){return[[A[0][0]*B[0][0]+A[0][1]*B[1][0],A[0][0]*B[0][1]+A[0][1]*B[1][1]],[A[1][0]*B[0][0]+A[1][1]*B[1][0],A[1][0]*B[0][1]+A[1][1]*B[1][1]]]}
function det2(A){return A[0][0]*A[1][1]-A[0][1]*A[1][0]}
function det3(M){const[a,b,c]=M[0],[d,e,f]=M[1],[g,h,i]=M[2];return a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h}
const coefNZ = ()=> [-3,-2,-1,1,2,3][rint(0,5)];
const term = (k,s)=> k===1?s:(k===-1?'−'+s:(k<0?'−'+Math.abs(k):k)+s);
const linComb = (k,l)=> term(k,'A')+(l>=0?' + ':' − ')+(Math.abs(l)===1?'B':Math.abs(l)+'B');

/* ---------- blueprints: ตัดข้อความมิติออก ---------- */
function makeBlueprints(){
  const bp = [];
  bp.push({type:'A+B',    dims:[2,3], title:'จงหาเมทริกซ์ A + B'});
  bp.push({type:'A-B',    dims:[3,3], title:'จงหาเมทริกซ์ A − B'});
  const k3=coefNZ(), l3=coefNZ();
  bp.push({type:'kA+lB',  dims:[2,2], k:k3, l:l3, title:`จงหาเมทริกซ์ ${linComb(k3,l3)}`});
  const a4=rint(1,3), c4=rint(-5,5), pos4=[rint(0,1), rint(0,1)], x4=rint(-5,5);
  bp.push({type:'solveX', dims:[2,2], a:a4, c:c4, pos:pos4, x:x4, title:'ให้เมทริกซ์ A = B จงหาค่าของ x'});
  bp.push({type:'mul',    dims:[2,2], title:'จงหาเมทริกซ์ A × B'});
  const op6 = Math.random()<.5 ? '+' : '−';
  bp.push({type:'At±B',   dims:[2,3], op:op6, title:`จงหาเมทริกซ์ Aᵀ ${op6} B`});
  bp.push({type:'2A+3Bt', dims:[2,2], title:'จงหาเมทริกซ์ 2A + 3Bᵀ'});
  bp.push({type:'det2',   dims:[2,2], title:'จงหา det(A)'});
  bp.push({type:'det3',   dims:[3,3], title:'จงหา det(A)'});
  const k10=coefNZ(), l10=coefNZ();
  bp.push({type:'det(kA+lB)', dims:[2,2], k:k10, l:l10, title:`จงหา det ของ ${linComb(k10,l10)} `});
  return bp;
}

/* ---------- จาก blueprint สร้างโจทย์แต่ละฝั่ง ---------- */
function buildSetFromBP(bp){
  const qs = [];
  for(const b of bp){
    if(b.type==='A+B'){
      const A=makeMatrix(2,3), B=makeMatrix(2,3);
      qs.push({kind:'matrix', title:b.title, data:{A,B}, answer:add(A,B)});
    } else if(b.type==='A-B'){
      const A=makeMatrix(3,3), B=makeMatrix(3,3);
      qs.push({kind:'matrix', title:b.title, data:{A,B}, answer:sub(A,B)});
    } else if(b.type==='kA+lB'){
      const A=makeMatrix(2,2), B=makeMatrix(2,2);
      const ans = add( scalar(A,b.k), scalar(B,b.l) );
      qs.push({kind:'matrix', title:b.title, data:{A,B,k:b.k,l:b.l}, answer:ans});
    } else if(b.type==='solveX'){
      const base=makeMatrix(2,2), A=deepCopy(base), B=deepCopy(base);
      const [i,j]=b.pos, a=b.a, c=b.c, x=b.x, y=a*x+c;
      A[i][j]=(a===1?'x':a+'x')+(c===0?'':(c>0?('+'+c):c));
      B[i][j]=y;
      qs.push({kind:'number', title:b.title, data:{A,B,a,c,pos:b.pos}, answer:x});
    } else if(b.type==='mul'){
      const A=makeMatrix(2,2), B=makeMatrix(2,2);
      qs.push({kind:'matrix', title:b.title, data:{A,B}, answer:mul2x2(A,B)});
    } else if(b.type==='At±B'){
      const A=makeMatrix(2,3), B=makeMatrix(3,2), At=transpose(A);
      const ans = b.op==='+' ? add(At,B) : sub(At,B);
      qs.push({kind:'matrix', title:b.title, data:{A,B,op:b.op}, answer:ans});
    } else if(b.type==='2A+3Bt'){
      const A=makeMatrix(2,2), B=makeMatrix(2,2);
      qs.push({kind:'matrix', title:b.title, data:{A,B}, answer:add(scalar(A,2), scalar(transpose(B),3))});
    } else if(b.type==='det2'){
      const A=makeMatrix(2,2);
      qs.push({kind:'number', title:b.title, data:{A}, answer:det2(A)});
    } else if(b.type==='det3'){
      const A=makeMatrix(3,3);
      qs.push({kind:'number', title:b.title, data:{A}, answer:det3(A)});
    } else if(b.type==='det(kA+lB)'){
      const A=makeMatrix(2,2), B=makeMatrix(2,2), C=add(scalar(A,b.k), scalar(B,b.l));
      qs.push({kind:'number', title:b.title, data:{A,B,k:b.k,l:b.l}, answer:det2(C)});
    }
  }
  return qs;
}

/* ---------- state + render ---------- */
const leftProblem = document.getElementById('leftProblem');
const rightProblem = document.getElementById('rightProblem');
const leftSolutions = document.getElementById('leftSolutions');
const rightSolutions = document.getElementById('rightSolutions');
const navGrid = document.getElementById('navGrid');
const qView = document.getElementById('qView');
const aView = document.getElementById('aView');
const topbar = document.getElementById('topbar');

let bp = makeBlueprints();
let leftQs = buildSetFromBP(bp);
let rightQs = buildSetFromBP(bp);

/* === สุ่มลำดับ 10 ข้อให้เหมือนกันทั้งสองฝั่ง === */
const order = Array.from({length: leftQs.length}, (_,i)=>i);
for (let i = order.length - 1; i > 0; i--) {
  const j = Math.floor(Math.random() * (i + 1));
  [order[i], order[j]] = [order[j], order[i]];
}
leftQs  = order.map(i => leftQs[i]);
rightQs = order.map(i => rightQs[i]);

let idx = 0;

function fmtM(M){
  let h='<div class="mwrap"><table class="matrix">';
  for(let i=0;i<M.length;i++){h+='<tr>';for(let j=0;j<M[0].length;j++)h+=`<td>${M[i][j]}</td>`;h+='</tr>'}
  h+='</table></div>';return h
}
function renderQuestionBody(q){
  let html = '';
  if(q.data){
    if(q.data.A) html += `<div class="mx"><span class="badge">A</span>${fmtM(q.data.A)}</div>`;
    if(q.data.B) html += `<div class="mx"><span class="badge">B</span>${fmtM(q.data.B)}</div>`;
  }
  return html;
}
function renderOne(q, nIdx){
  return `<div style="font-weight:700;margin-bottom:8px">ข้อ ${nIdx+1}) ${q.title}</div>${renderQuestionBody(q)}`;
}
function renderPair(){
  leftProblem.innerHTML  = renderOne(leftQs[idx], idx);
  rightProblem.innerHTML = renderOne(rightQs[idx], idx);
  updateNavState();
}
function buildNav(){
  navGrid.innerHTML='';
  for(let i=0;i<leftQs.length;i++){
    const b=document.createElement('button');
    b.className='qbtn'; b.textContent=i+1;
    b.addEventListener('click',()=>{idx=i;renderPair();});
    navGrid.appendChild(b);
  }
  updateNavState();
}
function updateNavState(){
  Array.from(navGrid.children).forEach((b,i)=> b.classList.toggle('current', i===idx));
}
document.getElementById('prevBtn').addEventListener('click',()=>{idx=Math.max(0,idx-1);renderPair();});
document.getElementById('nextBtn').addEventListener('click',()=>{idx=Math.min(leftQs.length-1,idx+1);renderPair();});

/* ---------- answers (แสดงโจทย์เต็ม + คำตอบ) ---------- */
function fmtAns(q){
  if(q.kind==='number') return `<div class="mwrap" style="display:inline-block"><b>${q.answer}</b></div>`;
  return fmtM(q.answer);
}
function renderSolutions(){
  leftSolutions.innerHTML=''; rightSolutions.innerHTML='';
  leftQs.forEach((q,i)=>{
    const c=document.createElement('div'); c.className='ans-card';
    c.innerHTML = `
      <div style="font-weight:700;margin-bottom:8px">ข้อ ${i+1}) ${q.title}</div>
      ${renderQuestionBody(q)}
      <div class="muted" style="margin-top:8px">คำตอบ:</div>
      ${fmtAns(q)}
    `;
    leftSolutions.appendChild(c);
  });
  rightQs.forEach((q,i)=>{
    const c=document.createElement('div'); c.className='ans-card';
    c.innerHTML = `
      <div style="font-weight:700;margin-bottom:8px">ข้อ ${i+1}) ${q.title}</div>
      ${renderQuestionBody(q)}
      <div class="muted" style="margin-top:8px">คำตอบ:</div>
      ${fmtAns(q)}
    `;
    rightSolutions.appendChild(c);
  });
}
document.getElementById('showAns').addEventListener('click',()=>{
  renderSolutions(); qView.style.display='none'; aView.style.display='block'; topbar.style.display='none';
});
document.getElementById('backBtn').addEventListener('click',()=>{
  aView.style.display='none'; qView.style.display='block'; topbar.style.display='';
});

/* ---------- countdown ---------- */
const timeEl = document.getElementById('timeLeft');
const add5 = document.getElementById('add5');
let remain = 30*60; // 30 นาที
function fmtTime(s){s=Math.max(0,s|0);const m=Math.floor(s/60),ss=s%60;return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;}
function tick(){
  remain--; if(remain<=0){remain=0;timeEl.classList.add('dead');}
  else if(remain<=5*60){timeEl.classList.add('warn');}
  timeEl.textContent = fmtTime(remain);
}
timeEl.textContent = fmtTime(remain);
const tmr = setInterval(tick, 1000);
add5.addEventListener('click',()=>{remain+=5*60;timeEl.classList.remove('dead');timeEl.textContent=fmtTime(remain);});

/* ---------- init ---------- */
buildNav();
renderPair();
</script>
</body>
</html>
